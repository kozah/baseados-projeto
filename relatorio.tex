\documentclass[11pt, a4paper]{article}
\usepackage[left=2cm, right=2cm, top=2cm]{geometry}
\usepackage[portuguese]{babel}
\usepackage{array}
\usepackage{amsmath}
\usepackage{enumerate}
\usepackage{amsfonts}

\begin{document}
\title{MAC0444 - Sistemas Baseados em Conhecimento \\ \large{Relatório do Projeto}}

\author{Lincoln Oliveira - NUSP: \\
    Marcos Castello - NUSP: \\
    Matheus S. Freire - NUSP: \\
    Natália Hitomi Koza - NUSP: 10698432}
\maketitle

\section*{Ontologia}

Somente referenciamos a ontologia FOAF.


\vspace{0.5cm}
\begin{center}
\begin{tabular}{cl}
    Conceitos & Descrição\\
    \hline
    Filme &
        \begin{tabular}{l}
            subconceito de \verb|foaf:Project|
        \end{tabular}\\
    \hline
    Ator &
        \begin{tabular}{l}
            subconceito de \verb|foaf:Person|
        \end{tabular}\\
    \hline
    Diretor &
        \begin{tabular}{l}
            subconceito de \verb|foaf:Person|
        \end{tabular}\\
    \hline
    Personagem &
        \begin{tabular}{l}
            subconceito de \verb|foaf:Project|
        \end{tabular}\\
    \hline
    Homem &
        \begin{tabular}{l}
            subconceito de \verb|foaf:Agent|
        \end{tabular}\\
    \hline
    Mulher &
        \begin{tabular}{l}
            subconceito de \verb|foaf:Agent|
        \end{tabular}\\
    \hline
\end{tabular}
\end{center}

\vspace{0.5cm}
\begin{center}
\begin{tabular}{cl}
    Propriedade & Descrição\\
    \hline
    atuaEm &
        \begin{tabular}{l}
            subpropriedade de \verb|foaf:made|\\
            inversa de atuadoPor\\
            propriedade assimétrica\\
            domínio: Ator\\
            range: Filme
        \end{tabular}\\
    \hline
    atuadoPor &
        \begin{tabular}{l}
            subpropriedade de \verb|foaf:maker|
        \end{tabular}\\
    \hline
    dirige &
        \begin{tabular}{l}
            subpropriedade de \verb|foaf:made|\\
            inversa de dirigidoPor\\
            domínio: Diretor\\
            range: Filme
        \end{tabular}\\
    \hline
    dirigidoPor &
        \begin{tabular}{l}
            subpropriedade de \verb|foaf:maker|
        \end{tabular}\\
    \hline
    interpreta &
        \begin{tabular}{l}
            subpropriedade de \verb|foaf:made|\\
            inversa de interpretadoPor\\
            domínio: Ator\\
            range: Personagem
        \end{tabular}\\
    \hline
    interpretadoPor &
        \begin{tabular}{l}
            subpropriedade de \verb|foaf:maker|
        \end{tabular}\\
    \hline
    temAnoDeLancamento &
        \begin{tabular}{l}
            tipo: owl:FunctionalProperty\\
            domínio: Filme\\
            range: inteiro
        \end{tabular}\\
    \hline
    temDuracao &
        \begin{tabular}{l}
        domínio: Filme\\
        range: inteiro
        \end{tabular}\\
    \hline
    temPrimeiroNome &
        \begin{tabular}{l}
            subpropriedade de \verb|foaf:firstName|\\
            tipo: owl:FunctionalProperty\\
            domínio: \verb|foaf:Person|\\
            range: string
        \end{tabular}\\
    \hline
    temSobrenome &
        \begin{tabular}{l}
            subpropriedade de \verb|foaf:familyName|\\
            tipo: owl:FunctionalProperty\\
            domínio: \verb|foaf:Person|\\
            range: string
        \end{tabular}\\
    \hline
    temTitulo &
        \begin{tabular}{l}
            domínio: Filme\\
            range: string
        \end{tabular}\\
    \hline
\end{tabular}
\end{center}

Instâncias:

\section*{Consultas}

Para todas as consultas os prefixos são:

\begin{verbatim}
PREFIX  rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX  owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX  xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX onto: <http://www.semanticweb.org/lincolnyuji/ontologies/2021/10/cinema-ontology#>
\end{verbatim}

\subsection*{Query 1}
Quais os títulos dos filmes que foram dirigidos pelo diretor \textbf{D}, em ordem lexicográfica?
Com \textbf{D} = onto:ethan\_coen:
\begin{verbatim}
SELECT ?TituloDoFilme
WHERE
{
  BIND (onto:ethan_coen AS ?D)
  ?D onto:dirige ?filme.
  ?filme onto:temTitulo ?TituloDoFilme.
}
ORDER BY ?TituloDoFilme
\end{verbatim}
\begin{center}
\begin{tabular}{|l|}
    \hline
    TituloDoFilme\\
    \hline
    "Barton Fink"\\
    "Blood Simple"\\
    "Fargo"\\
    "Intolerable Cruelty"\\
    "Miller's Crossing"\\
    "O Brother, Where Art Thou?"\\
    "Paris, je t'aime"\\
    "Raising Arizona"\\
    "The Hudsucker Proxy"\\
    "The Ladykillers"\\
    "The Man Who Wasn't There"\\
    \hline
\end{tabular}
\end{center}

\subsection*{Query 2}
Quais os primeiros nomes e últimos nomes dos atores que participaram do filme de título \textbf{F\textsubscript{t}}, em ordem lexicográfica de nome e sobrenome, com seus respectivos personagens?
Com \textbf{F\textsubscript{t}} = "American Beauty".
\begin{verbatim}
SELECT ?PrimeiroNome ?UltimoNome ?Personagem
WHERE
{
  BIND ("American Beauty" AS ?Ft)
  ?filme onto:temTitulo ?Ft.
  ?pessoa onto:atuaEm ?filme.
  ?pessoa onto:temPrimeiroNome ?PrimeiroNome.
  ?pessoa onto:temSobrenome ?UltimoNome.
  ?pessoa onto:interpreta ?Personagem.
}
ORDER BY ?PrimeiroNome ?UltimoNome
\end{verbatim}

\begin{center}
    \begin{tabular}{|l|l|l|}
        \hline
        PrimeiroNome & UltimoNome & Personagem \\
        \hline
        "Alison"   & "Faulk"   & personagem\_spartanette\_1   \\
        "Allison"   & "Janney"   & personagem\_barbara\_fitts   \\
        "Amber"   & "Smith"   & personagem\_christy\_kane   \\
        "Annette"   & "Bening"   & personagem\_carolyn\_burnham   \\
        "Ara"   & "Celi"   & personagem\_sale\_house\_woman\_1   \\
        "Barry"   & "Sherman"   & personagem\_brad\_dupree   \\
        "Brenda"   & "Wehle"   & personagem\_sale\_house\_woman\_4   \\
        "Carolina"   & "Lancaster"   & personagem\_spartanette\_4   \\
        "Chekeshka"   & "Putten"   & personagem\_spartanette\_6   \\
        "Chelsea"   & "Hertford"   & personagem\_playground\_girl\_2   \\
        "Chris"   & "Cooper"   & personagem\_col\_frank\_fitts\_usmc   \\
        "Chris"   & "Cooper"   & personagem\_frank\_booker   \\
        "Dennis"   & "Anderson"   & personagem\_mr\_smiley\_s\_manager   \\
        "Elaine"   & "Kendall"   & personagem\_newscaster   \\
        "Emily"   & "Zachary"   & personagem\_spartanette\_7   \\
        "Erin"   & "Strubbe"   & personagem\_young\_jane\_burnham   \\
        "Fort"   & "Atkinson"   & personagem\_sale\_house\_man\_2   \\
        "Heather"   & "Sher"   & personagem\_playground\_girl\_1   \\
        "Joel"   & "McCrary"   & personagem\_catering\_boss   \\
        "John"   & "Cho"   & personagem\_petey   \\
        "John"   & "Cho"   & personagem\_sale\_house\_man\_1   \\
        "Kent"   & "Faulcon"   & personagem\_sale\_house\_man\_3   \\
        "Kevin"   & "Spacey"   & personagem\_lester\_burnham   \\
        "Kevin"   & "Spacey"   & personagem\_roger\_verbal\_kint   \\
        "Krista"   & "Goodsitt"   & personagem\_spartanette\_2   \\
        "Lily"   & "Houtkin"   & personagem\_spartanette\_3   \\
        "Lisa"   & "Cloud"   & personagem\_sale\_house\_woman\_5   \\
        "Marissa"   & "Winokur"   & personagem\_mr\_smiley\_s\_counter\_girl   \\
        "Matthew"   & "Kimbrough"   & personagem\_firing\_range\_attendant   \\
        "Mena"   & "Suvari"   & personagem\_angela\_hayes   \\
        "Nancy"   & "Anderson"   & personagem\_spartanette\_8   \\
        "Peter"   & "Gallagher"   & personagem\_buddy\_kane   \\
        "Peter"   & "Gallagher"   & personagem\_vic\_tenetta\_party\_singer   \\
        "Reshma"   & "Gajjar"   & personagem\_spartanette\_9   \\
        "Romana"   & "Leah"   & personagem\_spartanette\_5   \\
        "Sam"   & "Robards"   & personagem\_jim\_berkley   \\
        "Scott"   & "Bakula"   & personagem\_jim\_olmeyer   \\
        "Stephanie"   & "Rizzo"   & personagem\_spartanette\_10   \\
        "Sue"   & "Casey"   & personagem\_sale\_house\_woman\_2   \\
        "Thora"   & "Birch"   & personagem\_enid   \\
        "Thora"   & "Birch"   & personagem\_jane\_burnham   \\
        "Wes"   & "Bentley"   & personagem\_ricky\_fitts   \\
        \hline
    \end{tabular}
\end{center}

\subsection*{Query 3}
Em quais filmes os atores \textbf{X} e \textbf{Y} atuaram juntos, com os respectivos diretores e anos de lançamento, do mais novo para o mais antigo?

Com \textbf{X} = onto:ben\_gazzara e \textbf{Y} = onto:steve\_buscemi

\begin{verbatim}
SELECT ?Filme ?Diretor ?Ano
WHERE
{
  BIND (onto:ben_gazzara AS ?X)
  BIND (onto:steve_buscemi AS ?Y)
  ?X onto:atuaEm ?Filme.
  ?Y onto:atuaEm ?Filme.
  FILTER (?X != ?Y).
  ?Diretor onto:dirige ?Filme.
  ?Filme onto:temAnoDeLancamento ?Ano.
}
ORDER BY DESC(?Ano)


\end{verbatim}

\begin{center}
    \begin{tabular}{|l|l|l|}
        \hline
        Filme & Diretor & Ano \\
        \hline
        filme\_paris\_je\_t\_aime   & alexander\_payne   & 2006   \\
        filme\_paris\_je\_t\_aime   & alfonso\_cuar\_n   & 2006   \\
        filme\_paris\_je\_t\_aime   & anne\_marie\_mi\_ville   & 2006   \\
        filme\_paris\_je\_t\_aime   & christoffer\_boe   & 2006   \\
        filme\_paris\_je\_t\_aime   & daniela\_thomas   & 2006   \\
        filme\_paris\_je\_t\_aime   & ethan\_coen   & 2006   \\
        filme\_paris\_je\_t\_aime   & ettore\_scola   & 2006   \\
        filme\_paris\_je\_t\_aime   & fr\_d\_ric\_auburtin   & 2006   \\
        filme\_paris\_je\_t\_aime   & g\_rard\_depardieu   & 2006   \\
        filme\_paris\_je\_t\_aime   & gus\_van\_sant   & 2006   \\
        filme\_paris\_je\_t\_aime   & isabel\_coixet   & 2006   \\
        filme\_paris\_je\_t\_aime   & jean\_luc\_godard   & 2006   \\
        filme\_paris\_je\_t\_aime   & joel\_coen   & 2006   \\
        filme\_paris\_je\_t\_aime   & nobuhiro\_suwa   & 2006   \\
        filme\_paris\_je\_t\_aime   & oliver\_schmitz   & 2006   \\
        filme\_paris\_je\_t\_aime   & olivier\_assayas   & 2006   \\
        filme\_paris\_je\_t\_aime   & richard\_lagravenese   & 2006   \\
        filme\_paris\_je\_t\_aime   & sylvain\_chomet   & 2006   \\
        filme\_paris\_je\_t\_aime   & tom\_tykwer   & 2006   \\
        filme\_paris\_je\_t\_aime   & vincenzo\_natali   & 2006   \\
        filme\_paris\_je\_t\_aime   & walter\_salles   & 2006   \\
        filme\_the\_big\_lebowski   & joel\_coen   & 1998   \\
    \end{tabular}
\end{center}

\subsection*{Query 4}
Quais filmes do diretor do filme F possuem X ou Y como atores, com as respectivas durações em ordem crescente?
\begin{verbatim}
SELECT ?filme ?duracao ?ator2
WHERE
{
  ?filme onto:dirigidoPor onto:francis_ford_coppola.
  {onto:a_j_cook onto:atuaEm ?filme} UNION {?ator2 onto:atuaEm ?filme}.
  ?filme onto:temDuracao ?duracao.
}
ORDER BY ?duracao
\end{verbatim}

\subsection*{Query 5}
Quais pessoas atuaram em um filme e dirigiram algum filme (não necessariamente o mesmo filme, mas obrigatoriamente a mesma pessoa)?
\begin{verbatim}
SELECT DISTINCT ?pessoa
WHERE
{
  ?pessoa onto:atuaEm ?filme1.
  ?filme2 onto:dirigidoPor ?pessoa.
}
\end{verbatim}

\subsection*{Query 6}
Quais diretores dirigiram algum filme em um ano entre os anos N1 e N2,  em que os atores X e Y aparecem, do mais antigo para o mais novo?
\begin{verbatim}
SELECT DISTINCT ?diretor
WHERE
{
  ?filme onto:temAnoDeLancamento ?ano.
  FILTER (?ano <= 2000).
  FILTER (?ano >= 1901).
  onto:a_j_cook onto:atuaEm ?filme.
  onto:allen_stewart_coates onto:atuaEm ?filme.
  ?filme onto:dirigidoPor ?diretor
}
ORDER BY ?ano
\end{verbatim}

\subsection*{Query 7}
Quais pares formados por uma uma atriz e um ator atuaram juntos em algum filme de duração entre M1 e M2?
\begin{verbatim}
SELECT ?atriz ?ator
WHERE
{
  ?atriz rdf:type onto:Mulher.
  ?ator rdf:type onto:Homem.
  ?atriz onto:atuaEm ?filme.
  ?ator onto:atuaEm ?filme.
  ?filme onto:temDuracao ?duracao.
  FILTER (?duracao <= 120).
  FILTER (?duracao >= 80).
}
ORDER BY ?duracao
\end{verbatim}

\subsection{Query 8}
Qual o diretor que mais dirigiu filmes em que aparece o ator de primeiro nome Xp e último nome Xu?
\begin{verbatim}
SELECT ?diretor (count(?filme) as ?quantFilmes)
WHERE
{
  ?pessoa rdf:type foaf:Person.
  ?pessoa onto:atuaEm ?filme.
  ?pessoa onto:temPrimeiroNome ?Pnome.
  ?pessoa foaf:familyName "Coppola".
  ?diretor onto:dirige ?filme.
}
GROUP BY ?diretor
ORDER BY DESC(?quantFilmes)
LIMIT 1
\end{verbatim}

\subsection*{Query 9}
Qual o filme mais antigo em que o ator X atuou, em que ano foi lançado e qual era seu personagem? Havendo empate, devolver todos
\begin{verbatim}
SELECT ?filme ?min_ano
WHERE
{
  ?ator onto:temPrimeiroNome "Alan".
  ?ator onto:atuaEm ?filme.
  ?filme onto:temAnoDeLancamento ?ano.
  FILTER (?ano = ?min_ano).
  {
  SELECT (MIN(?ano) as ?min_ano)
    WHERE
    {
      ?ator onto:temPrimeiroNome "Alan".
      ?ator onto:atuaEm ?filme.
      ?filme onto:temAnoDeLancamento ?ano.
    }
  }
}
\end{verbatim}

\subsection*{Query 10}
Qual o filme mais longo dirigido por D, e qual a sua duração? Havendo empate, devolver todos da mesma duração.
\begin{verbatim}
SELECT ?filme ?max_duracao
WHERE
{
  onto:ethan_coen onto:dirige ?filme.
  ?filme onto:temDuracao ?duracao.
  FILTER (?duracao = ?max_duracao).
  {
  SELECT (MAX(?duracao) as ?max_duracao)
    WHERE{
      onto:ethan_coen onto:dirige ?filme.
      ?filme onto:temDuracao ?duracao.
    }
  }
}
\end{verbatim}

\end{document}
